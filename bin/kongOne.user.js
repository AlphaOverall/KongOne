// ==UserScript==
// @name             Kongregate One
// @namespace        profusiongames.com
// @author           UnknownGuardian, AlphaOverall
// @version          2.0.0
// @date             04/19/2013
// @include          *://www.kongregate.com/*
// @description      Kongregate One - One script to rule them all. Everything here.
// ==/UserScript==

"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function e(t,a,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,a);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,a,o)}if("value"in i)return i.value;var n=i.get;if(void 0!==n)return n.call(o)},_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),Script=function(){function e(t,a,o){_classCallCheck(this,e),this.name=t,this.path=a,this.dom=null,this.defaultEnabled=o}return _createClass(e,[{key:"checkPath",value:function(){var e=document.location.pathname;return this.path.test(e)}},{key:"initialize",value:function(){this.dom="undefined"==typeof unsafeWindow?window:unsafeWindow,this.defaultEnabled||"null"!=GM_getValue("onescript-"+this.name,"null")||GM_setValue("onescript-"+this.name,"false"),this.checkPath()&&"true"==GM_getValue("onescript-"+this.name,"true")&&(console.log("[KongOne] Adding Script: "+this.name),this.run(),this.added=!0)}},{key:"run",value:function(){throw"run() not implemented for #{this.name} script"}}]),e}(),HolodeckScript=function(e){function t(e,a,o){_classCallCheck(this,t);var i=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a,o));return i.holodeckCheckCounter=0,i}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this;return this.holodeckCheckCounter++,"undefined"!=typeof holodeck&&holodeck.ready?void _get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initialize",this).call(this):this.holodeckCheckCounter>t.COUNTER_LIMIT?void console.log("[KongOne] "+this.name+" failed to load holodeck"):void setTimeout(function(){return e.initialize()},100)}}]),t}(Script);HolodeckScript.COUNTER_LIMIT=100;var AfkCommand=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Chat Afk Command",/^\/games/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){var e="kongregate_autoAFKTimeout",t="kongregate_autoAFKMessage",a=this.dom,o=a.holodeck,i=a.ChatDialogue,s=a.ChatRoom,n=a.ChatWindow,r=a.Base64;if(o&&i&&(i.prototype=a.CDprototype||a.ChatDialogue.prototype,s.prototype=a.CRprototype||a.ChatRoom.prototype,n.prototype=a.CWprototype||a.ChatWindow.prototype,!o.__afk)){o.__afk=!0,o.setPresenceAwayOld||(o.setPresenceAwayOld=o.setPresenceAway,o.setPresenceAway=function(){this._afk=1,this.setPresenceAwayOld()}),o.setPresenceChatOld||(o.setPresenceChatOld=o.setPresenceChat,o.setPresenceChat=function(){this._afk=0,this.setPresenceChatOld()}),s.prototype.updateUserOld_AFK||(s.prototype.updateUserOld_AFK=s.prototype.updateUser,s.prototype.updateUser=function(e){if(this.updateUserOld_AFK.apply(this,arguments),e.username==this._chat_window.username()&&this._presence!=e.variables.presence)switch(e.variables.presence){case"chat":this._chat_window._holodeck._afktoggle||(this._chat_window._holodeck._afk=0);break;case"away":this._chat_window._holodeck._afk=1}}),o._chat_commands.afk[0]=function(e,t){return 0===e._afk?e.setPresenceAway():e.setPresenceChat(),!1},o._chat_commands.back[0]=function(e,t){return e.setPresenceChat(),!1},o.addChatCommand("afkmessage",function(e,a){var o=void 0,i=a.match(/^\/\S+\s+(.+)/);return o=i?i[1]:"I am currently AFK",GM_setValue(t,o),e._afkmessage=o,e.activeDialogue().kongBotMessage("AFK-message set to: "+o),!1}),o.addChatCommand("afktoggle",function(e,t){return 0===e._afktoggle?(e._afktoggle=1,e.activeDialogue().kongBotMessage("Your AFK-flag won't get removed automatically")):(e._afktoggle=0,e.activeDialogue().kongBotMessage("Your AFK-flag will be removed automatically")),!1}),o.addChatCommand("autoafk",function(t,a){var o=a.match(/^\/autoafk\s+(\d+)/),i=15;return o&&o[1]&&(i=parseInt(o[1],10)),t._autoAFK=60*i*1e3,window.setTimeout(function(){GM_setValue(e,i)},0),t._autoAFKTimeout&&clearTimeout(t._autoAFKTimeout),i?(t.activeDialogue().kongBotMessage("Set auto-AFK timeout to "+i+" minute"+(i>1?"s":"")),t._autoAFKTimeout=setTimeout(function(e){e.setPresenceAway()},t._autoAFK,t)):t.activeDialogue().kongBotMessage("Disabled auto-AFK"),!1}),o.checkAFK=function(){this._afktoggle||(this._afk=0),this._autoAFKTimeout&&clearTimeout(this._autoAFKTimeout),this._autoAFK&&(this._autoAFKTimeout=setTimeout(function(e){e.setPresenceAway()},this._autoAFK,this))},o.addOutgoingMessageFilter(function(e,t){o.checkAFK(),t(e,t)}),n.prototype.oldSendPrivateMessageAFK||(n.prototype.oldSendPrivateMessageAFK=n.prototype.sendPrivateMessage,n.prototype.sendPrivateMessage=function(e,t){0!==t.indexOf(this._holodeck._afkprefix)&&this._holodeck.checkAFK(),this.oldSendPrivateMessageAFK(e,t)}),n.prototype.onLoginOldAFK||(n.prototype.onLoginOldAFK=n.prototype.onLogin,n.prototype.onLogin=function(){this.onLoginOldAFK(),this._holodeck._afk?this._holodeck.setPresenceAway():(this._holodeck.setPresenceChat(),this._holodeck.checkAFK())}),i.prototype.reply||(i.prototype.reply=function(e){}),i.prototype.showReceivedPM||(i.prototype.showReceivedPM=i.prototype.receivedPrivateMessage),i.prototype.receivedPrivateMessage=function(e){this.showReceivedPM(e),e.data.success&&(this.reply(e.data.from),this._holodeck._afk&&0!==r.decode(e.data.message).indexOf(this._holodeck._afkprefix)&&this.sendPrivateMessage(e.data.from,this._holodeck._afkprefix+this._holodeck._afkmessage))},o._afk=0,o._afktoggle=0,o._afkmessage=GM_getValue(t,"I am currently AFK"),o._afkprefix="[AFK] ";var A=15;try{GM_setValue?A=GM_getValue(e,15):GM_setValue=function(e,t){}}catch(e){GM_setValue=function(e,t){}}o._autoAFK=60*A*1e3,o._autoAFK>0&&(o._autoAFKTimeout=setTimeout(function(e){e.setPresenceAway()},o._autoAFK,o))}}}]),t}(HolodeckScript),ChatCharacterLimit=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Chat Character-limit",/^\/games/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){var e=this.dom,t=e.ChatDialogue;t&&(t.prototype=e.CDprototype||e.ChatDialogue.prototype,t.prototype.oldKeyPressLimit||(t.prototype.oldKeyPressLimit=t.prototype.onKeyPress,t.prototype.onKeyPress=function(e){var t=this._input_node.wrappedJSObject||this._input_node;if(this.oldKeyPressLimit(e),t.getValue().length>249){z=t.getValue();var a="",o=z.match(/^(\/\S+\s+\S*\s*)(.*)/);o?(a=o[2],a.length>249&&t.setValue(o[1]+a.substr(0,249))):t.setValue(t.getValue().substr(0,249))}}))}}]),t}(HolodeckScript),ChatLineHighlight=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Chat Line Highlight",/^\/games/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){var e=this.dom,t=e.holodeck,a=e.ChatDialogue,o=e.ChatRoom,i=e.ChatWindow;if(o&&a&&(a.prototype=e.CDprototype||e.ChatDialogue.prototype,o.prototype=e.CRprototype||e.ChatRoom.prototype,i.prototype=e.CWprototype||e.ChatWindow.prototype,!a.prototype.searchWord)){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),a.prototype.searchWord=function(e,t){for(var a=0;a<t.length;a++){var o=t[a].replace(/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g,"\\$1"),i=new RegExp("\\b"+o+"\\b");if(i.test(e))return!0}return!1},a.prototype.searchUser=function(e){return this.searchWord(e,this._holodeck._hluser)},a.prototype.searchText=function(e){var t=this._holodeck,a=t._highlighting.concat([t._username.toLowerCase()]);return this.searchWord(e,a)},i.prototype.hlFriend=function(e){return this._holodeck._hl_friends&&this.isFriend(e)},i.prototype.hlMod=function(e){if(this._holodeck._hl_mods)return this._rooms.any(function(t){var a=t[1],o=a.user(e);return o&&a.canUserModerate(o)})},i.prototype.friendOrMod=function(e){if(e.toLowerCase()==this._holodeck._username.toLowerCase())return"";var t=[];return this.hlMod(e)&&t.push(" hlmod"),this.hlFriend(e)&&t.push(" hlfriend"),t.length>1?t[this._holodeck._hl_priority]:t[0]||""},a.prototype.displayUnsanitizedMessageOldHighlight=a.prototype.displayUnsanitizedMessage,a.prototype.displayUnsanitizedMessage=function(e,a,o,i){o||(o={});var s=o.class||"",n=s.indexOf("whisper")>=0;if(i&&i.private||(s+=this._user_manager.friendOrMod(e.toLowerCase())),!n&&!this._user_manager.isMuted(e.toLowerCase())&&(this.searchUser(e.toLowerCase())||this.searchText(a.toLowerCase()))&&(s+=" highlight","function"==typeof this.new_private_message)){var r=t._pm_chime;t._pm_chime=t._hl_chime,this.new_private_message(),t._pm_chime=r}o.class=s,this.displayUnsanitizedMessageOldHighlight(e,a,o,i)},t.addChatCommand("highlight",function(e,t){var a=t.match(/^\/\S+\s+(.+)/),o="";return a&&(o=a[1]),o&&(o=o.replace(/\s+/g," ").trim(),window.setTimeout(function(){GM_setValue("kong_highlighting",o.toLowerCase())},0),e.activeDialogue().kongBotMessage("Now highlighting: "+o+" "+e._username),e._highlighting=o.toLowerCase().split(" ")),!1}),t.addChatCommand("hluser",function(e,t){var a=t.match(/^\/\S+\s+(.+)/),o="";return a&&(o=a[1]),o&&(o=o.replace(/\s+/g," ").trim(),window.setTimeout(function(){GM_setValue("kong_highlightuser",o.toLowerCase())},0),e.activeDialogue().kongBotMessage("Now highlighting user(s): "+o),e._hluser=o.toLowerCase().split(" ")),!1});var s=function(e,t,a){return function(o,i){return o["_hl_"+e]?(o["_hl_"+e]=0,o.activeDialogue().kongBotMessage(t||"Stopped highlighting messages by "+e)):(o["_hl_"+e]=1,o.activeDialogue().kongBotMessage(a||"Now highlighting messages by "+e)),window.setTimeout(function(){GM_setValue("kong_highlight"+e,o["_hl_"+e])},0),!1}};t.addChatCommand("hlmods",s("mods")),t.addChatCommand("hlfriends",s("friends")),t.addChatCommand("hlchime",s("chime","Stopped playing the chime for highlighted messages","Now playing the chime for highlighted messages")),t.addChatCommand("hlpriority",s("priority","Now prioritizing mods over friends","Now prioritizing friends over mods"));var n=function(e,t,a,o,i){return i||(i=1),function(s,n){var r=n.match(/^\/\S+\s+#?([0-9a-f]{6})/i),A="",l=0;if(r&&(A="#"+r[1]),A){for(var c=function(){return GM_setValue("kong_"+a,A)},h=0;h<w.cssRules.length;h++)if(0===w.cssRules[h].selectorText.indexOf(e)&&(w.cssRules[h].style.setProperty(t,A,"important"),++l==i))return window.setTimeout(c,0),s.activeDialogue().kongBotMessage("New "+(o||a)+": "+A),!1}else s.activeDialogue().kongBotMessage("No valid color! Format is /"+a+" XXXXXX (X = hex character)");return!1}};t.addChatCommand("whispercolor",n("#kong_game_ui .chat_message_window .whisper","background-color","whispercolor")),t.addChatCommand("friendcolor",n("#kong_game_ui .chat_message_window .hlfriend span.chat_message_window_username","color","friendcolor")),t.addChatCommand("hlcolor",n("#kong_game_ui .chat_message_window .highlight","background-color","hlcolor","highlighting-color",2)),t.addChatCommand("modcolor",n("#kong_game_ui .chat_message_window .hlmod span.chat_message_window_username","color","modcolor")),t.addChatCommand("hllist",function(e,a){function o(e){i.displayUnsanitizedMessage("Kong Bot",e,{class:"whisper received_whisper"},{non_user:!0})}var i=e.activeDialogue();return o("Current highlighting settings:"),t._hluser.length>0?(o("Users:"),o("Users: "+t._hluser.map(function(e){return['<a href="#" onclick="holodeck.showMiniProfile(\'',e,"'); return false;\">",e,"</a>"].join("")}).join(" "))):o("No users highlighted"),o(t._highlighting.length>0?"Words: "+t._highlighting.join(" "):"No words highlighted"),o('Highlight color: <span style="color: '+r+'">'+r+"</span>"),o('Whisper color: <span style="color: '+A+'">'+A+"</span>"),o("Highlighting friends: "+(t._hl_friends?"Yes":"No")+' (color: <span style="color: '+l+'">'+l+"</span>)"),o("Highlighting mods: "+(t._hl_mods?"Yes":"No")+' (color: <span style="color: '+c+'">'+c+"</span>)"),o("Highlight priority: "+(t._hl_priority?"Friends over mods":"Mods over friends")),o("Playing chime: "+(t._hl_chime?"undefined"!=typeof t._pm_chime?"Yes":'No, <a href="http://userscripts.org/scripts/show/65622">script</a> not installed':"No")),!1}),t.addChatCommand("hlreset",function(e,a){var o=e.activeDialogue();return o.kongBotMessage("Resetting all highlighting preferences"),t._chat_commands.hlcolor[0](t,"/color #def6ea"),t._chat_commands.whispercolor[0](t,"/color #deeaf6"),t._chat_commands.friendcolor[0](t,"/color #006600"),t._chat_commands.modcolor[0](t,"/color #ba6328"),t._hl_priority=1,t._hl_friends=1,t._hl_mods=1,t._hl_chime=1,t._highlighting=[],t._hluser=[],["highlighting","highlightuser","hlcolor","whispercolor","friendcolor","modcolor","highlightfriends","highlightpriority","highlightmods","highlightchime"].forEach(function(e){window.setTimeout(function(){GM_deleteValue("kong_"+e)},0)}),!1}),t._chat_commands.hl=t._chat_commands.highlight,t._chat_commands.hlfriend=t._chat_commands.hlfriends,t._highlighting=[],t._hluser=[];var r="#def6ea",A="#deeaf6",l="#006600",c="#ba6328",h=1,d=1,u=1,_=1;if("function"!=typeof GM_setValue)GM_setValue=GM_getValue=function(){};else{var m=GM_getValue("kong_highlightcolor","");m&&(GM_setValue("kong_hlcolor",m),"undefined"==typeof GM_deleteValue?GM_setValue("kong_highlightcolor",""):GM_deleteValue("kong_highlightcolor"));var p=GM_getValue("kong_highlighting"),g=GM_getValue("kong_highlightuser");r=GM_getValue("kong_hlcolor","#def6ea")||"#def6ea",A=GM_getValue("kong_whispercolor","#deeaf6")||"#deeaf6",l=GM_getValue("kong_friendcolor","#006600")||"#006600",c=GM_getValue("kong_modcolor","#ba6328")||"#ba6328",d=GM_getValue("kong_highlightfriends",1),h=GM_getValue("kong_highlightpriority",1),u=GM_getValue("kong_highlightmods",1),_=GM_getValue("kong_highlightchime",1),p&&(t._highlighting=p.trim().split(" ")),g&&(t._hluser=g.trim().split(" "))}t._hl_friends=d,t._hl_mods=u,t._hl_chime=_,t._hl_priority=h;var v=document.createElement("style"),f=document.getElementsByTagName("head")[0];(f||document.body).appendChild(v);for(var w=null,k=document.styleSheets.length-1;k>=0;--k)try{if(document.styleSheets[k].cssRules&&document.styleSheets[k].cssRules.length){w=document.styleSheets[k];break}}catch(e){}if(!w)return void alert("Kongregate Chat Line Highlighting could not find a style sheet!\nPlease send a message to Ventero about this problem.");w.insertRule("#kong_game_ui .chat_message_window .whisper { background-color: "+A+" !important; }",w.cssRules.length),w.insertRule("#kong_game_ui .chat_message_window .highlight.even { background-color: "+r+" !important; }",w.cssRules.length),w.insertRule("#kong_game_ui .chat_message_window .highlight { background-color: "+r+" !important; }",w.cssRules.length),w.insertRule("#kong_game_ui .chat_message_window .hlfriend span.chat_message_window_username { color: "+l+" !important; }",w.cssRules.length),w.insertRule("#kong_game_ui .chat_message_window .hlmod span.chat_message_window_username { color: "+c+" !important; }",w.cssRules.length)}}}]),t}(HolodeckScript),ChatMouseoverTimestamp=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Chat Mouseover Timestamp",/^\/games/,!1))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){function e(e,t,a,o){var i=new e.Element("div",{id:"message_rollover_template",class:"user_rollover_container spritesite",style:"display: none"}),s=new e.Element("div",{class:"user_rollover spritesite"}),n=new e.Element("div",{class:"user_rollover_inner"}),r=new e.Element("p",{class:"rollover_message_private_message_link_message_link_holder"}),A=new e.Element("a",{id:"rollover_message_private_message_link",class:"rollover_message_private_message_link",href:"#"}).update("Private Message");r.appendChild(A);var l=new e.Element("p",{id:"rollover_time_text"});n.appendChild(l),n.appendChild(r),s.appendChild(n),i.appendChild(s),t("chat_tab_pane").appendChild(i);var c=e.MessageRollover=function(e){return this.initialize(e),this};c.prototype={initialize:function(a){if(this._active_dialogue=a,this._holodeck=a._holodeck,this._rollover_template_node=t("message_rollover_template"),this._private_message_node=t("rollover_message_private_message_link"),this._time_node=t("rollover_time_text"),this._private_message_observer=function(){},this._rollover_template_node){var o=this;this._rollover_template_node.observe("mouseover",function(t){o.stopHide(),e.Event.stop(t)}),this._rollover_template_node.observe("mouseout",function(t){o.beginHide(),e.Event.stop(t)})}},show:function(e,t,a){this._hideTimer&&clearTimeout(this._hideTimer),this.updatePrivateMessageLink(t),this.updateTimeText(e),this.setRolloverPosition(a),this._rollover_template_node.show()},setRolloverPosition:function(e){var t=e.target,a=this._active_dialogue._message_window_node.scrollTop,o=t.positionedOffset()[1];o-=9;var i=o;a<o&&(i=o-a);var s=i+"px";this._rollover_template_node.setStyle({top:s});var n=t.getWidth(),r=20+n,A=r+"px";this._rollover_template_node.setStyle({left:A})},updatePrivateMessageLink:function(t){var a=this._holodeck.chatWindow();this._private_message_node.stopObserving("click"),this._private_message_observer=e.CapturesToInlineRegistration.decorate(function(o){return a.insertPrivateMessagePrefixFor(t),e.Event.stop(o),!1}),this._private_message_node.observe("click",this._private_message_observer)},updateTimeText:function(e){this._time_node.innerHTML=e},beginHide:function(){var e=this;this._hideTimer&&clearTimeout(this._hideTimer),this._hideTimer=setTimeout(function(){e.hide()},500)},stopHide:function(){clearTimeout(this._hideTimer)},hide:function(){this._rollover_template_node.hide()}},o.MESSAGE_TEMPLATE.template='<p class="#{classNames}"><span username="#{username}" time="#{time}" class="username #{userClassNames}">#{prefix}#{username}</span><span class="separator">: </span><span class="message">#{message}</span><span class="clear"></span></p>',o.MESSAGE_TEMPLATE.old_evaluate=o.MESSAGE_TEMPLATE.evaluate,o.MESSAGE_TEMPLATE.evaluate=function(e){var t,o=new Date,i=o.getHours(),s=o.getMinutes(),n=o.getSeconds();return t=12==a._timeFormat?(i<10?0===i?"12":"0"+i:i>12?i>21?i-12:"0"+(i-12):i)+":"+(s<10?"0":"")+s+":"+(n<10?"0":"")+n+(i>11?" PM":" AM"):(i<10?"0":"")+i+":"+(s<10?"0":"")+s+":"+(n<10?"0":"")+n,e.time=t,this.old_evaluate(e)},o.prototype.initialize=o.prototype.initialize.wrap(function(t,a,o,i,s){t(a,o,i,s),this._messages_until_next_collection=0,this._holodeck=i,this._user_manager=s,this._parent_node=a,this._messages_count=0,this._insertion_count=0,this._onInputFunction=o,this._message_rollover_manager=new c(this),this._message_window_node=a.down(".chat_message_window"),this._input_node=a.down(".chat_input"),this._messages_to_retain=200,this._message_window_node.stopObserving(),this._message_window_node.observe("mouseover",function(t){var a=t.target.getAttribute("time"),o=t.target.getAttribute("username");a&&(i.activeDialogue().showMessageRollover(a,o,t),e.Event.stop(t))}),this._message_window_node.observe("mouseout",function(t){i.activeDialogue().hideMessageRollover(),e.Event.stop(t)});var n=this;this._input_node;this._input_node.observe("keypress",function(e){n.onKeyPress(e)}),this._input_node.observe("focus",function(e){n.clearPrompt()}),this._message_window_node.observe("click",function(e){if(e.target){var t=e.target.getAttribute("username");t&&(e.stop(),s.showProfile(t))}})}),o.prototype.showMessageRollover=function(e,t,a){this._message_rollover_manager.show(e,t,a)},o.prototype.hideMessageRollover=function(){this._message_rollover_manager.beginHide()}}var t=this.dom,a=t.holodeck,o=t.ChatDialogue;t.$;if(a&&o&&(!o.prototype&&t.CDprototype&&(o.prototype=t.CDprototype),!a.__mouseover)){a.__mouseover=!0;var i=document.createElement("script");i.type="text/javascript",i.textContent="("+e.toString()+")(window, $, holodeck, ChatDialogue);",document.body.appendChild(i),setTimeout(function(){document.body.removeChild(i)},100),a.addChatCommand("timeformat",function(e,t){var a=t.match(/^\/\S+\s+(\d+)/),o="",i=e.activeDialogue();return a&&(o=a[1]),12==o||24==o?(e._timeFormat=o,window.setTimeout(function(){GM_setValue("kong_timeformat",o)},0),i.displayMessage("Timeformat","Set to "+o+"-hour clock (hh:mm:ss"+(12==o?" AM/PM)":")"),{class:"whisper received_whisper"},{non_user:!0})):i.displayMessage("Timeformat","Allowed values: 12 and 24",{class:"whisper received_whisper"},{non_user:!0}),!1});var s=12;"undefined"!=typeof GM_setValue?s=GM_getValue("kong_timeformat",12)||12:GM_setValue=function(){},a._timeFormat=s}}}]),t}(HolodeckScript),ChatResizer=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Chat Resizer",/^\/games/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){var e=this,t=this.dom;if(t.defaultWidth=500,t.defaultHeight=600,t.spaceLeft=200,t.center=!0,t.userListHeight=100,$("maingamecontent")){var a=($("maingamecontent").offsetTop+$("chat_tab_pane").offsetTop,$("maingamecontent").offsetLeft+$("chat_tab_pane").offsetLeft,parseInt($("game").style.height,10)-parseInt($("main_tab_set").clientHeight,10)-16),o=300;if(t.holodeck){var i=t.holodeck;i.addChatCommand("size",function(e,t){var a=t.match(/^\/\S+\s+(\S+)/),o=t.match(/^\/\S+\s+(\d+)\s+(\d+)(?:\s+(\d+))?/);if(a&&"reset"==a[1])return e.activeDialogue().kongBotMessage("Resetting size for this game to defaults."),window.setTimeout(function(){GM_deleteValue("kong_resize_"+location.pathname)},0),this.setWidth(window._defaultChatWidth),this.setHeight(window._defaultChatHeight,window._defaultUserlistHeight,window._currentGameCentered),!1;if(a&&"show"==a[1])return e.activeDialogue().kongBotMessage("Current chat size: width: "+window._currentChatWidth+"px, height: "+window._currentChatHeight+"px, userlist-height: "+window._currentChatUserlistHeight+"px."),!1;if(!o)return e.activeDialogue().kongBotMessage("Please specify a width and a height: /size width height. Example: /size 500 500"),!1;var i=parseInt(o[1],10),s=parseInt(o[2],10),n=parseInt(o[3]||100,10),r=parseInt($("game").style.height,10);return i<300&&(e.activeDialogue().kongBotMessage("Minimum width is 300. Setting width to 300px."),i=300),s<r&&(e.activeDialogue().kongBotMessage("Minimum height is the game's height. Setting height to "+r+"px."),s=r),n>s-200&&(e.activeDialogue().kongBotMessage("Userlist height is too large. Setting it to 100px"),n=100),window.setTimeout(function(){GM_setValue("kong_resize_"+location.pathname,i+"/"+s+"/"+n)},0),e.activeDialogue().kongBotMessage("Resizing chat to "+i+"px/"+s+"px/"+n+"px"),this.setWidth(i),this.setHeight(s,n,window._currentGameCentered),!1}),i.addChatCommand("defaultsize",function(e,t){var a=t.match(/^\/\S+\s+(\S+)/),o=t.match(/^\/\S+\s+(\d+)\s+(\d+)(?:\s+(\d+))?/);if(a&&"reset"==a[1])return e.activeDialogue().kongBotMessage("Resetting default size to 500/600/100"),window.setTimeout(function(){GM_deleteValue("kong_resize_default")},0),!1;if(a&&"show"==a[1])return e.activeDialogue().kongBotMessage("Current chat size: width: "+window._defaultChatWidth+"px, height: "+window._defaultChatHeight+"px, userlist-height: "+window._defaultUserlistHeight+"px."),!1;o||e.activeDialogue().kongBotMessage("Syntax /defaultsize width height userlist-height. userlist-height is optional. Example: /defaultsize 500 500 100");var i=parseInt(o[1],10),s=parseInt(o[2],10),n=parseInt(o[3]||100,10);return i<300&&(e.activeDialogue().kongBotMessage("Minimum width is 300. Setting width to 300px."),i=300),n>s&&(e.activeDialogue().kongBotMessage("Userlist height is too large. Setting it to 100px"),n=100),window.setTimeout(function(){GM_setValue("kong_resize_default",i+"/"+s+"/"+n)},0),e.activeDialogue().kongBotMessage("Set default values to width: "+i+"px, height: "+s+"px, userlist-height: "+n+"px."),!1}),i.addChatCommand("centergame",function(t,a){var o=!window._currentGameCentered;return o?t.activeDialogue().kongBotMessage("Now centering the game"):t.activeDialogue().kongBotMessage("Now aligning the game to the chat's bottom"),window.setTimeout(function(){GM_setValue("kong_resize_center",o?1:0)},0),e.centerGame(o),!1}),i.addChatCommand("draggable",function(e,t){var a=document.getElementById("chat_container");return a.style.resize="both",a.onresize=function(){var t=document.getElementById("chat_window");t.style.width=a.style.width,t.style.height=a.style.height,e.activeDialogue().kongBotMessage("Chat window is now resizeable")},!1})}var s="",n=-1,r="";s=GM_getValue("kong_resize_"+location.pathname,""),n=GM_getValue("kong_resize_center",-1),r=GM_getValue("kong_resize_default","");var A=void 0;r&&(A=r.split("/"),t.defaultWidth=parseInt(A[0],10)||t.defaultWidth,t.defaultHeight=parseInt(A[1],10)||t.defaultHeight,t.userListHeight=parseInt(A[2],10)||t.userListHeight),window._defaultChatWidth=t.defaultWidth,window._defaultChatHeight=t.defaultHeight,window._defaultUserlistHeight=t.userListHeight;var l=t.defaultWidth,c=t.defaultHeight,h=t.userListHeight,d=t.center,u=!1;n!=-1&&(d=1==n),s&&(A=s.split("/"),l=parseInt(A[0],10)||t.defaultWidth,c=parseInt(A[1],10)||t.defaultHeight,h=parseInt(A[2],10)||t.userListHeight,u=!0);var _=parseInt($("game").style.width,10),m=parseInt($("game").style.height,10);if(l>o)if(u||_+l<screen.width-t.spaceLeft)this.setWidth(l);else{var p=screen.width-_-t.spaceLeft;p>o&&this.setWidth(p)}c>a&&c>m?this.setHeight(c,h,d):this.setHeight(m,h,d)}}},{key:"centerGame",value:function(e){if(window._currentGameCentered=e,e){var t=parseInt($("game").style.height,10),a=parseInt($("maingame").style.height,10);$("game").style.top=(a-t)/2+"px",$("game").style.position="relative"}else $("game").style.bottom="0px",$("game").style.top="",$("game").style.position="absolute"}},{key:"setHeight",value:function(e,t,a){t||(t=100),window._currentChatHeight=e,window._currentChatUserlistHeight=t;var o=$("quicklinks")?$("quicklinks").parentNode.clientHeight:26,i=$("main_tab_set").clientHeight,s=e-16,n=e+o+i;parseInt($("game").style.height,10);$("maingame").style.height=n+"px",$("maingamecontent").style.height=n+"px",$("flashframecontent").style.height=n+"px",$("chat_container").style.height=e+i+"px",$("user_mini_profile_container").style.height=e-65+"px",$("user_mini_profile").style.height=e-65+"px";for(var r=$$(".chat_message_window"),A=0;A<r.length;A++)r[A].style.height=s-t-93+"px";var l=$$(".users_in_room");for(A=0;A<l.length;A++)l[A].style.height=t+"px";var c=$$(".rooms_list");for(A=0;A<c.length;A++)c[A].style.height=e-79+"px";var h=$("kong_game_ui").childNodes;for(A=0;A<h.length;A++)"DIV"==h[A].nodeName&&(h[A].style.height=s+"px");a!=-1&&void 0!==a&&this.centerGame(a)}},{key:"setWidth",value:function(e){window._currentChatWidth=e;var t=parseInt($("game").style.width,10);$("maingame").style.width=t+3+e+"px",$("maingamecontent").style.width=t+3+e+"px",$("flashframecontent").style.width=t+3+e+"px",$("chat_container").style.width=e+"px",$("chat_window_spinner").style.right=e/2-38+"px",$("high_scores_spinner")&&($("high_scores_spinner").style.right=e/2-38+"px");for(var a=$("kong_game_ui"),o=a.childNodes,i=0;i<o.length;i++)"DIV"==o[i].tagName&&(o[i].style.width=e-17+"px");this.$A(a.querySelectorAll("textarea.chat_input")).forEach(function(t){t.style.width=e-21+"px"})}},{key:"$A",value:function(e){return[].slice.call(e)}}]),t}(HolodeckScript),ChatTimestamp=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Chat Timestamp",/^\/games/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){var e=this.dom,t=e.holodeck,a=e.ChatDialogue;if(t&&a&&(a.prototype=e.CDprototype||e.ChatDialogue.prototype,!t.__timestamp)){t.__timestamp=!0,t.addChatCommand("timeformat",function(e,t){var a=t.match(/^\/\S+\s+(\d+)/),o="",i=e.activeDialogue();return a&&(o=a[1]),12==o||24==o?(e._timeFormat=o,window.setTimeout(function(){GM_setValue("kong_timeformat",o)},0),i.displayMessage("Timeformat","Set to "+o+"-hour clock (hh:mm:ss"+(12==o?" AM/PM)":")"),{class:"whisper received_whisper"},{non_user:!0})):i.displayMessage("Timeformat","Allowed values: 12 and 24",{class:"whisper received_whisper"},{non_user:!0}),!1}),t.addChatCommand("tscolor",function(e,t){var a=t.match(/^\/\S+\s+([0-9a-f]{6})/i),o="";return a&&(o="#"+a[1]),o?(n(o),window.setTimeout(function(){GM_setValue("kong_timestampcolor",o)},0),e.activeDialogue().displayMessage("Timestamp","Set font-color to "+o,{class:"whisper received_whisper"},{non_user:!0})):e.activeDialogue().displayMessage("Timestamp","No valid color! Format is /tscolor ###### (# = hex character)",{class:"whisper received_whisper"},{non_user:!0}),!1}),t.addChatCommand("toggleseconds",function(e,t){return e._showSeconds?(e._showSeconds=0,e.activeDialogue().displayMessage("Timestamp","Now hiding seconds",{class:"whisper received_whisper"},{non_user:!0})):(e._showSeconds=1,e.activeDialogue().displayMessage("Timestamp","Now showing seconds",{class:"whisper received_whisper"},{non_user:!0})),window.setTimeout(function(){GM_setValue("kong_timeshowseconds",e._showSeconds)},0),!1});var o=12,i="#999999",s=0;o=GM_getValue("kong_timeformat",12)||12,i=GM_getValue("kong_timestampcolor","#999999")||"#999999",s=GM_getValue("kong_timeshowseconds",0)||0,t._timeFormat=o,t._showSeconds=s;var n=function(e){function t(e){a.innerHTML="span.inline_timestamp { color: "+e+" !important; }"}var a=document.createElement("style");return a.setAttribute("type","text/css"),t(e),document.body.appendChild(a),t}(i);a.MESSAGE_TEMPLATE.template='<p class="#{classNames}"><span style="float: left;" class="inline_timestamp">[#{time}]&nbsp;</span><span username="#{username}" class="username #{userClassNames}">#{prefix}#{username}</span><span class="separator">: </span><span class="message">#{message}</span><span class="clear"></span></p>',a.MESSAGE_TEMPLATE.old_evaluate_inline=a.MESSAGE_TEMPLATE.evaluate,a.MESSAGE_TEMPLATE.evaluate=function(e){var a,o=new Date,i=o.getHours(),s=o.getMinutes(),n=o.getSeconds();return a=12==t._timeFormat?(i<10?0===i?"12":"0"+i:i>12?i>21?i-12:"0"+(i-12):i)+":"+(s<10?"0":"")+s+(t._showSeconds?":"+(n<10?"0":"")+n:"")+(i>11?" PM":" AM"):(i<10?"0":"")+i+":"+(s<10?"0":"")+s+(t._showSeconds?":"+(n<10?"0":"")+n:""),e.time=a,this.old_evaluate_inline(e)}}}}]),t}(HolodeckScript),Kongquer=function(_HolodeckScript7){function Kongquer(){return _classCallCheck(this,Kongquer),_possibleConstructorReturn(this,(Kongquer.__proto__||Object.getPrototypeOf(Kongquer)).call(this,"Kongquer",/^\/games/,!0))}return _inherits(Kongquer,_HolodeckScript7),_createClass(Kongquer,[{key:"run",value:function run(){function makeLink(e){return'<a href="#" onclick="holodeck.showMiniProfile(\''+e+"'); return false;\">"+e+"</a>"}"undefined"==typeof holodeck||holodeck.__urlregex||(holodeck.__urlregex=!0);var dom=this.dom,holodeck=dom.holodeck,ChatDialogue=dom.ChatDialogue;holodeck.addChatCommand("test",function(e,t){return e.activeDialogue().displayUnsanitizedMessage("Kong Bot","Script is active! Have fun...",{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("avg",function(e,t){for(var a=e.chatWindow().activeRoom(),o=a.users(),i=0,s=0;s<o.length;s++)i+=o[s]._level;var n=Math.round(i/o.length*10)/10;return e.activeDialogue().displayUnsanitizedMessage("Average Level in Room",n,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck&&ChatDialogue&&!holodeck._chat_commands.mostplayed&&(holodeck.addChatCommand("mostplayed",function(e,t){
function a(e){return 1==e?"":"s"}var o=t.match(/\/\S+\s+(\d+)/),i=e.activeDialogue(),s=5,n=dom.$A(e.chatWindow().activeRoom().users()),r=n.length;o&&o[1]&&(s=o[1]);var A=dom.$H();n.each(function(e){var t=e._game_url;A.get(t)||A.set(t,{title:e._game_title,count:0,user:"",url:t}),A.get(t).count++,A.get(t).user=e.username});var l=A.values().sort(function(e,t){return+t.count-+e.count}).slice(0,s),c=A.size();return i.displayUnsanitizedMessage("Kong Bot",r+" user"+a(r)+" playing "+c+" different game"+a(c),{class:"whisper received_whisper"},{non_user:!0}),i.displayUnsanitizedMessage("Kong Bot",s+" most played game"+a(s)+":",{class:"whisper received_whisper"},{non_user:!0}),l.each(function(e){i.displayUnsanitizedMessage("Kong Bot",e.count+" user"+a(e.count)+" ("+(e.count>1?"":makeLink(e.user)+", ")+(100*e.count/r).toFixed(1)+"%) "+(e.count>1?"are":"is")+' playing <a href="'+e.url+'">'+e.title+"</a>",{class:"whisper received_whisper"},{non_user:!0})}),!1}),holodeck._chat_commands.mp=holodeck._chat_commands.getmp=holodeck._chat_commands.mostplayed),holodeck.addChatCommand("highlvl",function(e,t){for(var a=e.chatWindow().activeRoom(),o=a.users(),i="",s=0,n=0,r=0;r<o.length;r++)o[r]._level>s?(s=o[r]._level,i='<img src="'+o[r]._chat_avatar_url+'">'+makeLink(o[r].username),n=1):o[r]._level==s&&(i=i+', <img src="'+o[r]._chat_avatar_url+'">'+makeLink(o[r].username),n+=1);return e.activeDialogue().displayUnsanitizedMessage("Highest Level in Room",s+", Usercount: "+n+", Users: "+i,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("lowlvl",function(e,t){for(var a=e.chatWindow().activeRoom(),o=a.users(),i="",s=1/0,n=0,r=0;r<o.length;r++)o[r]._level<s?(s=o[r]._level,i='<img src="'+o[r]._chat_avatar_url+'">'+makeLink(o[r].username),n=1):o[r]._level==s&&(n+=1,i=i+', <img src="'+o[r]._chat_avatar_url+'">'+makeLink(o[r].username));return e.activeDialogue().displayUnsanitizedMessage("Lowest Level in Room",s+", Usercount: "+n+", Users: "+i,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("list",function(e,t){var a=e.chatWindow().activeRoom(),o=a.users(),i="",s=t.match(/^\/\S+\s+(.+)/),n=0;if(s){for(var r=s[1],A=0;A<o.length;A++)o[A].username.toLowerCase().includes(r.toLowerCase())&&(""===i?(i='<img src="'+o[A]._chat_avatar_url+'">'+makeLink(o[A].username),n=1):(n+=1,i=i+', <img src="'+o[A]._chat_avatar_url+'">'+makeLink(o[A].username)));e.activeDialogue().displayUnsanitizedMessage("Usernames Containing "+s[1],"Usercount: "+n+", Users: "+i,{class:"whisper received_whisper"},{non_user:!0})}else e.activeDialogue().displayUnsanitizedMessage("Kong Bot","Please use this command like "+t+" cat",{class:"whisper received_whisper"},{non_user:!0});return!1}),holodeck.addChatCommand("levels",function(e,t){var a=t.match(/^\/\S+\s+(.+)/),o=e.chatWindow().activeRoom(),i=o.users(),s=void 0,n=void 0;if(a){var r="",A="";if(s=[],a[1].includes("-")){var l=a[1].split("-");if(l[0]<l[1])for(n=l[0];n<=l[1];n++)s.push(n);else for(n=l[1];n<=l[0];n++)s.push(n);A=a[1]}else s=a[1].split(" "),A=s.join(", ");for(var c=0,h=0;h<=s.length;h++)for(var d=0;d<i.length;d++)i[d]._level==s[h]&&""===r?(r='<img src="'+i[d]._chat_avatar_url+'">'+makeLink(i[d].username),c=1):i[d]._level==s[h]&&(c+=1,r=r+', <img src="'+i[d]._chat_avatar_url+'">'+makeLink(i[d].username));return e.activeDialogue().displayUnsanitizedMessage("Level "+A,"Usercount: "+c+", Users: "+r,{class:"whisper received_whisper"},{non_user:!0}),!1}for(var u=[e._active_user._attributes._object.level],_=0;_<i.length;_++)for(var m=0;m<=i[_]._level;m++)i[_]._level==m&&u.indexOf(m)<0&&u.push(m);return u.sort(function(e,t){return e-t}),e.activeDialogue().displayUnsanitizedMessage("Levels",u.join(", "),{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("highfans",function(e,t){for(var a,o=e.chatWindow().activeRoom(),i=o.users(),s=function(e){r=e.responseText},n=0;n<i.length;n++){var r,A=i[n].username,l="http://www.kongregate.com/accounts/"+A+"#user_followers",c=new XMLHttpRequest;c.addEventListener("load",s,!1),c.open("GET",l,!0),c.send();var h=document.createElement("div");h.innerHTML=r;h.getElementsByTagName("li")}return e.activeDialogue().displayUnsanitizedMessage("Highest Fans in Room",a,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("developer",function(e,t){for(var a=e.chatWindow().activeRoom(),o=a.users(),i=[],s=0;s<o.length;s++)o[s]._developer&&i.push(makeLink(o[s].username));return e.activeDialogue().displayUnsanitizedMessage("Developers in room",i.join(", "),{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("admin",function(e,t){for(var a=e.chatWindow().activeRoom(),o=a.users(),i=[],s=0;s<o.length;s++)o[s]._admin&&i.push(makeLink(o[s].username));return e.activeDialogue().displayUnsanitizedMessage("Admins in room",i.join(", "),{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("moderator",function(e,t){for(var a=e.chatWindow().activeRoom(),o=a.users(),i=[],s=0;s<o.length;s++)(o[s]._moderator_room_ids.length>0||o[s]._moderator_game_ids.length>0)&&i.push(o[s].username);return e.activeDialogue().displayUnsanitizedMessage("Mods in room",i.join(", "),{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("id",function(e,t){var a=e._active_user._attributes._object;return e.activeDialogue().displayUnsanitizedMessage("ID",a.id,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("username",function(e,t){var a=e._active_user._attributes._object;return e.activeDialogue().displayUnsanitizedMessage("Username",makeLink(a.username),{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("kreds",function(e,t){var a=e._active_user._attributes._object;return e.activeDialogue().displayUnsanitizedMessage("Kreds",a.kreds_balance,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("level",function(e,t){var a=e._active_user._attributes._object;return e.activeDialogue().displayUnsanitizedMessage("Level",a.level,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("age",function(e,t){var a=e._active_user._attributes._object;return e.activeDialogue().displayUnsanitizedMessage("Age",a.age,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("email",function(e,t){var a=e._active_user._attributes._object;return e.activeDialogue().displayUnsanitizedMessage("Name/Email",a.sender_name_or_email,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("user",function(e,t){var a=t.match(/^\/\S+\s+(.+)/),o=void 0;if(!a)return o=e._active_user._attributes._object,e.activeDialogue().displayUnsanitizedMessage("Username",'<img src="'+o.avatar_url+'">'+makeLink(o.username),{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Age",o.age,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Admin/Moderator/Developer/Premium",o.admin+"/"+o.moderator+"/"+o.developer+"/"+o.premium,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("ID",o.id,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Level",o.level,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Points for Next Level",o.points_away,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Total Points",o.points,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Last Level Up",o.last_levelup_at,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Kreds",o.kreds_balance,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Gameplays",o.gameplays_count,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Game Ratings",o.ratings_count,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("BOTD Earned This Week",o.botds_this_week,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Name/Email",o.sender_name_or_email,{class:"whisper received_whisper"},{non_user:!0}),!1;for(var i=e.chatWindow().activeRoom(),s=i.users(),n=0;n<s.length;n++){if(n==s.length-1&&s[n].username!=a[1])return e.activeDialogue().displayUnsanitizedMessage("Kong Bot","User not in chat... Opening mini profile",{class:"whisper received_whisper"},{non_user:!0}),holodeck.showMiniProfile(a[1]),!1;if(s[n].username==a[1])return o=s[n],e.activeDialogue().displayUnsanitizedMessage("Username",'<img src="'+o._chat_avatar_url+'"></img>'+makeLink(o.username),{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Level",o._level,{class:"whisper received_whisper"},{non_user:!0}),0===o._moderator_room_ids.length&&0===o._moderator_game_ids.length?e.activeDialogue().displayUnsanitizedMessage("Admin/Moderator/Developer/Premium",o._admin+"/false/"+o._developer+"/"+o._premium,{class:"whisper received_whisper"},{non_user:!0}):(e.activeDialogue().displayUnsanitizedMessage("Admin/Moderator/Developer/Premium",o._admin+"/true/"+o._developer+"/"+o._premium,{class:"whisper received_whisper"},{non_user:!0}),o._admin||(e.activeDialogue().displayUnsanitizedMessage("Moderator Game Ids",o._moderator_game_ids.join(", "),{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Moderator Room Ids",o._moderator_room_ids.join(", "),{class:"whisper received_whisper"},{non_user:!0}))),e.activeDialogue().displayUnsanitizedMessage("Playing",'<a href="http://www.kongregate.com'+o._game_url+'" target="_blank">'+o._game_title+"</a>",{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Presence",o._presence,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Role",o._role,{class:"whisper received_whisper"},{non_user:!0}),!1}}),holodeck.addChatCommand("available",function(e,t){var a=t.match(/^\/\S+\s+(.+)/);return a&&e.activeDialogue().displayUnsanitizedMessage("Kong Bot","Availability of "+a[1]+':<iframe src="httP://www.kongregate.com/accounts/availability?username='+a[1]+'" width="100%" height="30"></iframe>',{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("info",function(e,t){var a=e._chat_window._active_room,o=a._room;return e.activeDialogue().displayUnsanitizedMessage("Room Name",o.name,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Room ID",o.id,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Room Owner",'<a href="http://www.kongregate.com/accounts/'+o.owner+'" target="_blank">'+o.owner+"</a>",{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Room Type",o.type,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Favorite Room",a._favorite_room,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Users In Room",a._number_in_room_node.innerText,{class:"whisper received_whisper"},{non_user:!0}),e.activeDialogue().displayUnsanitizedMessage("Guests In Room",a._guests_in_room_node.innerText,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("botd",function(e,t){var a=e._active_user._attributes._object,o="(easy)";return 5==a.botd_reward_points||(o=15==a.botd_reward_points?"(medium)":30==a.botd_reward_points?"(hard)":60==a.botd_reward_points?"(impossible)":"Points: "+a.botd_reward_points),e.activeDialogue().displayUnsanitizedMessage("BOTD",'<img src="'+a.botd_icon_uri+'"></img><a href="'+a.botd_game_uri+'" target="_blank">'+a.botd_game_name+" - "+a.botd_description+"</a> "+o,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("friends",function(e,t){var a=e._chat_window._friends,o=[];for(var i in a)o.push('<a href="http://www.kongregate.com/accounts/'+i+'" target="_blank">'+i+"</a>");return e.activeDialogue().displayUnsanitizedMessage("Friends",o.join(", "),{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("online",function(e,t){return holodeck._chat_window.showOnlineFriends(),!1}),holodeck.addChatCommand("exit",function(e,t){return close(),!1}),holodeck.addChatCommand("open",function(e,t){var a=t.match(/^\/\S+\s+(.+)/);return a[1]?(m=a[1].split(" "),"accounts"==m[0]?m[1]?open("http://www.kongregate.com/accounts/"+m[1],"_blank"):open("http://www.kongregate.com/accounts/"+e._active_user._attributes._object.username):"games"==m[0]?m[1]?m[2]?open("http://www.kongregate.com/games/"+m[1]+"/"+m[2],"_blank"):e.activeDialogue().displayUnsanitizedMessage("Kong Bot","No specified game",{class:"whisper received_whisper"},{non_user:!0}):e.activeDialogue().displayUnsanitizedMessage("Kong Bot","No specified game creator",{class:"whisper received_whisper"},{non_user:!0}):open("http://www.kongregate.com/search?q="+a[1],"_blank")):open("http://www.kongregate.com/accounts/"+e._active_user._attributes._object.username),!1}),holodeck.addChatCommand("khelp",function(e,t){return open("http://www.kongregate.com/pages/help","_blank"),!1}),holodeck.addChatCommand("kong",function(e,t){return open("http://www.kongregate.com","_blank"),!1}),holodeck.addChatCommand("help",function(e,t){return open("http://www.alphaoverall.com","_blank"),!1}),holodeck.addChatCommand("signup",function(e,t){return lightbox.prototype.initializeKongregateLightboxFromAjax("/accounts/new/behind_login?game_id="+active_user.gameId(),{afterStaticContentLoad:lightbox.prototype.toggleRegistration}),!1}),holodeck.addChatCommand("login",function(e,t){return active_user.activateInlineLogin(),!1}),holodeck.addChatCommand("signout",function(e,t){return signoutFromSite(),!1}),holodeck.addChatCommand("google",function(e,t){var a=t.match(/^\/\S+\s+(.+)/);return a?open("https://www.google.com/search?q="+a[1],"_blank"):open("https://www.google.com","_blank"),!1}),holodeck.addChatCommand("bing",function(e,t){var a=t.match(/^\/\S+\s+(.+)/);return a?open("https://www.bing.com/search?q="+a[1],"_blank"):open("https://www.bing.com","_blank"),!1}),holodeck.addChatCommand("yahoo",function(e,t){var a=t.match(/^\/\S+\s+(.+)/);return a?open("https://search.yahoo.com/search;_ylt=Aq7xBwaF.DQZx151DcVK87ybvZx4?p="+a[1],"_blank"):open("https://www.yahoo.com","_blank"),!1}),holodeck.addChatCommand("wikipedia",function(e,t){var a=t.match(/^\/\S+\s+(.+)/);return a?open("https://en.wikipedia.org/wiki/"+a[1].replace(" ","_"),"_blank"):open("https://en.wikipedia.org/","_blank"),!1}),holodeck.addChatCommand("url",function(e,t){var a=t.match(/^\/\S+\s+(.+)/);return a?a[1].includes("http://")||a[1].includes("https://")?open(a[1],"_blank"):open("http://"+a[1],"_blank"):e.activeDialogue().displayUnsanitizedMessage("Kong Bot","Please use command like "+t+" https://www.google.com",{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("calculator",function(l,n){var z=n.match(/^\/\S+\s+(.+)/),output="Nothing happened";if(z)if("help"==z[1])l.activeDialogue().displayUnsanitizedMessage("Math Commands","+,-,*,<br>Math.abs(a) = absolute value of a<br>Math.acos(a) = arc cosine of a<br>Math.asin(a) = arc sine of a<br>Math.atan(a) = arc tangent of a<br>Math.atan2(a,b) = arc tangent of a/b<br>Math.ceil(a) = integer closest to a and not less than a<br>Math.cos(a) = cosine of a<br>Math.exp(a) = exponent of a (Math.E to the power a)<br>Math.floor(a) = integer closest to a, not greater than a<br>Math.log(a) = log of a base e<br>Math.max(a,b) = the maximum of a and b<br>Math.min(a,b) = the minimum of a and b<br>Math.pow(a,b) = a to the power b<br>Math.random() = pseudorandom number 0 to 1<br>Math.round(a) =  integer closest to a <br> Math.sin(a) = sine of a<br>Math.sqrt(a) = square root of a<br>Math.tan(a) = tangent of a",{class:"whisper received_whisper"},{non_user:!0});else try{output=eval(z[1]),l.activeDialogue().displayUnsanitizedMessage("Calculation",z[1]+" = "+output,{class:"whisper received_whisper"},{non_user:!0})}catch(e){l.activeDialogue().displayUnsanitizedMessage("Kong Bot",e,{class:"whisper received_whisper"},{non_user:!0})}else l.activeDialogue().displayUnsanitizedMessage("Kong Bot","Please use command like "+n+" 4+3-8*9/3^.5",{class:"whisper received_whisper"},{non_user:!0});return!1}),holodeck.addChatCommand("youtube",function(e,t){var a=t.match(/^\/\S+\s+(.+)/);if(a){var o=a[1].split(" ");if("embed"==o[0]){var i,s=document.getElementsByClassName("chat_message_window");i=void 0!==s[2]&&s[2].offsetHeight>s[1].offsetHeight?s[2]:s[1];var n=i.offsetHeight;n=i.offsetWidth>i.offsetHeight?i.offsetHeight:9*i.offsetWidth/16,o[1].includes("youtu.be/")?e.activeDialogue().displayUnsanitizedMessage("YouTube",'<iframe src="https://www.youtube.com/embed/'+o[1].split("youtu.be/")[1]+'" width="100%" height="'+n+'"></iframe>',{class:"whisper received_whisper"},{non_user:!0}):o[1].includes("youtube.com/watch?v=")?e.activeDialogue().displayUnsanitizedMessage("YouTube",'<iframe src="https://www.youtube.com/embed/'+o[1].split("youtube.com/watch?v=")[1]+'" width="100%" height="'+n+'"></iframe>',{class:"whisper received_whisper"},{non_user:!0}):e.activeDialogue().displayUnsanitizedMessage("YouTube","Invalid YouTube video url",{class:"whisper received_whisper"},{non_user:!0})}else open("https://www.youtube.com/results?search_query="+a[1],"_blank")}else open("https://www.youtube.com","_blank");return!1}),holodeck.addChatCommand("mp3",function(e,t){var a=t.match(/^\/\S+\s+(.+)/);return a[1].includes(".mp3")?e.activeDialogue().displayUnsanitizedMessage("MP3 Container",'<audio src="'+a[1]+'" controls><embed src="'+a[1]+'"\twidth="100%" height="90" loop="false" autostart="true"/></audio>',{class:"whisper received_whisper"},{non_user:!0}):e.activeDialogue().displayUnsanitizedMessage("MP3 Container","Invalid mp3 url",{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("img",function(e,t){var a=t.match(/^\/\S+\s+(.+)/);return a[1].includes(".jpg")||a[1].includes(".jpeg")||a[1].includes(".png")||a[1].includes(".gif")||a[1].includes(".bmp")?e.activeDialogue().displayUnsanitizedMessage("IMG Container",'<img src="'+a[1]+'" style="max-width:100%; max-height:100%;"/>',{class:"whisper received_whisper"},{non_user:!0}):e.activeDialogue().displayUnsanitizedMessage("IMG Container","Invalid img url",{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("time",function(e,t){var a=new Date,o=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()+", "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();return e.activeDialogue().displayUnsanitizedMessage("Date/Time",o,{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck.addChatCommand("reload",function(e,t){return location.reload(),!1}),holodeck.addChatCommand("reloadgame",function(e,t){return activateGame(),!1}),holodeck.addChatCommand("removegame",function(e,t){try{var a=document.getElementById("gameholder");a.parentNode.removeChild(a);var o=document.getElementById("chat_container").offsetWidth;o=(o>550?o+5:570)+"px",document.getElementById("flashframecontent").style.width=o,document.getElementById("maingamecontent").style.width=o;var i=document.getElementById("maingame");i.style.width=o,i.style.height=parseInt(i.style.height)+5+"px"}catch(t){e.activeDialogue().displayUnsanitizedMessage("Kong Bot","No Game Found / Could not resize",{class:"whisper received_whisper"},{non_user:!0})}return!1}),holodeck.addChatCommand("clear",function(e,t){return holodeck._active_dialogue.clear(),!1}),holodeck.addChatCommand("cry",function(e,t){return e.activeDialogue().displayUnsanitizedMessage("You're sad!","(　-̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥᷄◞ω◟-̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥̥᷅ )",{class:"whisper received_whisper"},{non_user:!0}),!1}),holodeck._chat_commands.wiki=holodeck._chat_commands.wikipedia,holodeck._chat_commands.weep=holodeck._chat_commands.krie=holodeck._chat_commands.cry,holodeck._chat_commands.lol=holodeck._chat_commands.hi=holodeck._chat_commands.hmm=holodeck._chat_commands.test,holodeck._chat_commands.userlist=holodeck._chat_commands.username=holodeck._chat_commands.list,holodeck._chat_commands.date=holodeck._chat_commands.datetime=holodeck._chat_commands.now=holodeck._chat_commands.time,holodeck._chat_commands.math=holodeck._chat_commands.calc=holodeck._chat_commands.calculator,holodeck._chat_commands.goto=holodeck._chat_commands.http=holodeck._chat_commands.www=holodeck._chat_commands.url,holodeck._chat_commands.lvl=holodeck._chat_commands.level,holodeck._chat_commands.konghelp=holodeck._chat_commands.kongregatehelp=holodeck._chat_commands.khelp,holodeck._chat_commands.kongregate=holodeck._chat_commands.kong,holodeck._chat_commands.avglvl=holodeck._chat_commands.alvl=holodeck._chat_commands.avg,holodeck._chat_commands.close=holodeck._chat_commands.exit,holodeck._chat_commands.roominfo=holodeck._chat_commands.info,holodeck._chat_commands.friendsonline=holodeck._chat_commands.online,holodeck._chat_commands.u=holodeck._chat_commands.me=holodeck._chat_commands.user,holodeck._chat_commands.admins=holodeck._chat_commands.administrator=holodeck._chat_commands.administrators=holodeck._chat_commands.admin,holodeck._chat_commands.dev=holodeck._chat_commands.devs=holodeck._chat_commands.developers=holodeck._chat_commands.developer,holodeck._chat_commands.mod=holodeck._chat_commands.mods=holodeck._chat_commands.moderators=holodeck._chat_commands.moderator,holodeck._chat_commands.hlvl=holodeck._chat_commands.highlevel=holodeck._chat_commands.hlevel=holodeck._chat_commands.highlvl,holodeck._chat_commands.llvl=holodeck._chat_commands.lowlevel=holodeck._chat_commands.llevel=holodeck._chat_commands.lowlvl,holodeck._chat_commands.mp=holodeck._chat_commands.getmp=holodeck._chat_commands.mostplayed}}]),Kongquer}(HolodeckScript),KongreLink=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Chat KongreLink",/^\/games/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){window.location.assign('javascript:void(holodeck.addIncomingMessageFilter(function(m,n){var REGEX=/((?:<\\S[^>]+?)?(?:>)?)?(\\b(?:(?:(ht|f)tp)s?:\\/\\/)?(((?:\\w+[.])?(?:[a-z0-9][a-z0-9\\-]{0,61}[a-z0-9]|[a-z0-9]{1,2})[.])*(a(?:c|d|e(?:ro)?|f|g|i|l|m|n|o|q|r(?:pa)?|s(?:ia)?|t|u|w|x|z)|b(?:a|b|d|e|f|g|h|i|iz|j|l|m|n|o|r|s|t|v|w|y|z)|c(?:at?|c|d|f|g|h|i|k|l|m|n|o(?:m|op)?|r|u|v|x|y|z)|d[ejkmoz]|e(?:c|du|e|g|h|r|s|t|u)|f[ijkmor]|g(?:a|b|d|e|f|g|h|i|l|m|n|ov|p|q|r|s|t|u|w|y)|h[kmnrtu]|i(?:d|e|l|m|n(?:fo|t)|o|q|r|s|t)|je|jm|jo|jobs|jp|k[eghimnprwyz]|l[abcikrstuvy]|m(?:a|c|d|e|f|g|h|i?l|k|m|n|o(?:bi)?|p|q|r|s|t|u(?:seum)?|v|w|x|y|z)|n(?:a(?:me)?|c|et?|f|g|i|l|o|p|r|u|z)|om|org|p(?:a|e|f|g|h|k|l|m|n|ro?|s|t|w|y)|qa|r[eosuw]|s(?:a|b|c|d|e|g|h|i|j|k|l|m|n|o|r|t|u|v|y|z)|t(?:c|d|e?l|f|g|th|j|k|m|n|o|p|r(?:avel)?|t|v|w|z)|u[agkmsyz]|v[aceginu]|w[fs]|y[etu]|z[amw])\\b([.]\\B)?|\\d+[.]\\d+[.]\\d+[.]\\d+)(?::\\d+)?)(\\/+\\??(?:\\S+))?/ig,lF=/(?:<(\\S)[^>]+?href=["\'])(?:\\b((?:(ht|f)tp)s?:\\/\\/)?(((?:\\S+[.])?(?:[a-z0-9][a-z0-9\\-]{0,61}[a-z0-9]|[a-z0-9]{1,2})[.])*(a(?:c|d|e(?:ro)?|f|g|i|l|m|n|o|q|r(?:pa)?|s(?:ia)?|t|u|w|x|z)|b(?:a|b|d|e|f|g|h|i|iz|j|l|m|n|o|r|s|t|v|w|y|z)|c(?:at?|c|d|f|g|h|i|k|l|m|n|o(?:m|op)?|r|u|v|x|y|z)|d[ejkmoz]|e(?:c|du|e|g|h|r|s|t|u)|f[ijkmor]|g(?:a|b|d|e|f|g|h|i|l|m|n|ov|p|q|r|s|t|u|w|y)|h[kmnrtu]|i(?:d|e|l|m|n(?:fo|t)|o|q|r|s|t)|je|jm|jo|jobs|jp|k[eghimnprwyz]|l[abcikrstuvy]|m(?:a|c|d|e|f|g|h|i?l|k|m|n|o(?:bi)?|p|q|r|s|t|u(?:seum)?|v|w|x|y|z)|n(?:a(?:me)?|c|et?|f|g|i|l|o|p|r|u|z)|om|org|p(?:a|e|f|g|h|k|l|m|n|ro?|s|t|w|y)|qa|r[eosuw]|s(?:a|b|c|d|e|g|h|i|j|k|l|m|n|o|r|t|u|v|y|z)|t(?:c|d|e?l|f|g|th|j|k|m|n|o|p|r(?:avel)?|t|v|w|z)|u[agkmsyz]|v[aceginu]|w[fs]|y[etu]|z[amw])\\b([.]\\B)?|\\d+[.]\\d+[.]\\d+[.]\\d+)(?::\\d+)?)?(\\/+(?:\\S+))??(?:["\'][^>]*?>([\\s\\S]+?)<\\/\\1>)/gi,q=function(w,c,r,l){var t,a,d;w=w.substring(0,(t=r.lastIndex)-(a=c[0]).length)+(a=("<a "+(l?l[1]:\'\')+" href=\'"+(((d=c[3])=="ht"||d=="f")?"":"http://")+(d=a).replace(/<a[^>]+?href=(["\'])([\\s\\S]+?)\\1[^>]*?>[\\s\\S]+<\\/a>/, "$2")+"\' target=\'_blank\'>"+(c[9]||d)+"</a>"))+w.substring(t,w.length);REGEX.lastIndex+=a.length-d.length;return w},Q=function(b){var w=b,t=REGEX.lastIndex=0,a,c,d;while(c=REGEX.exec(w)){if(c[1]||(!c[5]&&!c[7])||(c[7]&&!(c[3]||c[8])))continue;w=q(w,c,REGEX)};while(c=lF.exec(w)){c[3]=\'ht\';w=q(w,c,lF,c[0].match(/(class=([\'"])[^>]+?\\2)[\\s\\S]*?>/i))};return w};return n(Q(m),n)}))')}}]),t}(HolodeckScript),LargerAvatars=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Larger Forum Avatars",/^\/(posts|messages|private_messages)/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){var e=document.createElement("style");e.innerHTML=".post .user_avatar, .messages_table .user_avatar {width: 80px; height: 80px;} .sender_info {width: auto !important;}";var t=document.getElementsByTagName("head")[0];t.appendChild(e);for(var a=document.getElementsByClassName("hover_profile"),o=0;o<a.length;o++)a[o].innerHTML=a[o].innerHTML.replace("width:40","width:140");GM_addStyle(".post .author {width: 260px; #feature {width: 952px;}}")}}]),t}(Script),PmNotifier=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Chat PM Notifier",/^\/games/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){var e=this.dom,t=e.holodeck,a=e.ChatDialogue;if(a&&(a.prototype=e.CDprototype||e.ChatDialogue.prototype,!a.prototype.new_private_message)){e._animatedFav=!1,e._pmCount=0,e._baseTitle=document.title,e._blurred=!1,e._chime=e.document.createElement("audio"),e._chime.setAttribute("src","data:audio/wav;base64,UklGRi4IAABXQVZFZm10IBAAAAABAAEAESsAABErAAABAAgAZGF0YakHAACAgIGBgYKEh4qLjIyNjY2LioqJh4aGio2QkZGRkI6Lh4B3cXJ0dnp/g4aHiImDdm1pZmVnbHR6fYGLlZuhpKOgnp2dnJGCdWldU0pEPjgyOktaaHR+homLjZWYjn9wYFJNSUZCPkNadYuitMXU2+Dn7uXRv7KnoaCkqKagpLO8wsfJyMG7uLetlYBzaF5ZVFNVVFFWYmt1fH58dm9pZl9NOy4hFQsEBAgKDRwyQ1NldICIi4+Xm5iVkId/eHR0dHN0gZWnuMna6fX6/P/979/Ova+knpybmJWZoaOlp6elopuVk4t7bF9SSUNAP0JGR0xZZXB8g4eLjod6aVdJPjEjHyUwPUlSXnKEiYF0aF1SQjIvOEdZa3iJnaqspp6WlZOLipSlus7d5vD17t/Qv7Oup5+cpbPCztHT1dTFrZN6ZVhLPjo/SVRcW1xiZFtKNiQYEAgAAg4fMkBIUV5mZV9ZVVpjZ218kanB0tzl7Ori2M/IyMrIydDd6vX49fHt4cy0nYd5cGVdXWJpb29pZmZhVEIuHRIMBQAEDhonMTY9RkxMSkVCRk9UWWV3ip6uusPLzcrFwLu7wMPFy9fj7/j6+PTs38y4o5OJgXhzdnuAhYR/endvYU87KiAaEw8SGyYxO0BGTlJQS0VAQEZKTllrf5WsvcHBwcC8s62xvcfT4+/z9vn359PEuayhm5iTi4J3alpQTkxFPjovIRYNBQIKHC0+UGFkXltbWFRXaX+UqsPZ4+fq6uHUzs7LyMvT19HGt5+Da19YVFJWW1ZNRTwvJis2QElVX1tRS05QUmF8mbHK5vn79e7j0b60rqqorLjCv7WnkHFVRDYtKzE2NDAvLysnLDlDTVpna2NdYmptdYqlu9Dn+v/68+zeyLavq6eor7i+vbeslnZcTkAzLS0uKiUmJiIdIzE6PkRMTUQ8P0ZLU2mJpLrT7Pv8+fXs28rEwr67v8vW1Mm/uLCllHdeVlJHNichIy5AXH2NjYuKhXpsaHJ6eHFoXFVWYHF2bWFVR0FETFdbV1piZ25/l7TM1tnZ0MfDwcPN1NTKtZ6Uj4iEgHRlU0I+RElSW1tZV1NTXGp/m662uLGloKCls8DCuaaMd2lgX2JeU0Y2KyszP0xSUFBQTlJfc4uisr/Hw7y8wMfS2NTHr5OAdGtpa2pmXlNNUFVaX15bWlhWW2RziJ2uvcbGwsC+wMXHw7ikjXpsY2JmZ2ZhV05LTE5RT0lFRUVKU2Fzhpajr7Owr66usrW0rqGNe25kXl9gX1xVTUtMT1RYWFdZXGFqdYSVpbG7wsK+vLm5vL26sqibj4d/enp5dW9mXFZTUFBQS0dGR0pSYHWGjY2RnK7Ayse3opOSmJaGbFFFSVRWTDwyPVd2iIh8cHWKqr++pouAh5idjGtLP0hdZ1xGOENkj6+2rKCmwOP589aznp+rq5RrQzI7UWBbSDU2T3eaqJ+NhpOwy9G/n4eDjpaIZDodGSk8PzMgGCdLdI+XkIuWstXq5syunaGtr5p0TTg6SlZTRTc3TnWarayhnarH5fPpzK6en6SehmJBMjVCRz4sHiE5X4CRj4WBjqnH1c62npOVmpV/YEU7QlBXTjwtLUJkhZeZk5GbscnVzrunnZ6jnolpSz1BUl9fUkRATmqKoKejnqCsvsnEspyNjJOWinFUPjhATVJMQDg8TmiAjZGSl6S5zNTMu6mhpKqpm4BjT0pPWFpTS0ZNXHGAh4aDhIydrbOsnIyGipSZkoFwYVZQUVRZYGdpa25sZWNpdoynur65rqKZlpaVl56ioJmLdV9SS09bZmZcTj4xMjtIU1xbVFJWWFdZXmp/ma24vbispaixvMza39rQwK6gl4yCgYOCfHBcRzs7QEpXW1ZOR0A9Q09gdo2eqK+xqZ+Zl5qltL/AuKaOeWxlYmVrbWpjWk5HRklOVl1fXVxbV1ZbZ3eMn6y0ubq1sK6vsLa9wsTAtqaViH52c3V1cWpgVU5MTk9RVFNQUVNUVVpganeIlZ6kpaGbl5eYm6Glp6ahmY2De3JtbG5vbmpiWlVWWV1jZmZjY2VnbHJ5gImSmqCmqaijn5ybnaKmqKahmZCKhYF9enh0cW5qZmRiYmJkZmdnaGhoaWtvdX2EiYyOkZKSkZGQj5CRkpOSkIqFgHt3dXNyc3R1dnl9gYOBfXh1c3Fta2xvcnV3e4CEhoaGhoiIhoSEhomNkJSan6GhnpuZlpGMiIaGhYOCg4WGhoOBfXp1cGtnZ2dnZ2hrbm9ubGtqaWdmZmltcHN2eXx9fHp6ent7e3x/g4iMj5KWmZqamZeWlJGOi4qJiYmJiouNjY2LioiFgn98e3p5eXl5ent7e3p6enp6enp6e3x8fH19fX19fn5+fn5+f39/f39/f3+AgICAgICAgICBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgABMSVNUWAAAAElORk9JQ09QHwAAAENvcHlyaWdodCCpIENpbmVtYXRyb25pY3MgMTk5NQAASVBSRCMAAABNaWNyb3NvZnQgUGx1cyEgriBmb3IgV2luZG93cyA5NSCuAAA="),e._chime.load(),window.onblur=function(){e._blurred=!0},window.onfocus=function(){e._blurred=!1,e.pmReset()},e.pmReset=function(){e._animatedFav&&e.toggleFavLink(),e._pmCount=0,document.title=e._baseTitle},e.createFavLink=function(e){var t=document.createElement("link");return t.type=e.type,t.rel=e.rel,t.href=e.href,t},e.toggleFavLink=function(){for(var t=document.getElementsByTagName("head")[0],a=t.getElementsByTagName("link"),o=0;o<a.length;o++){var i=a[o];"shortcut icon"==i.rel&&t.removeChild(i)}e._animatedFav?t.appendChild(e.createFavLink(e._staticFavLinkAttr)):t.appendChild(e.createFavLink(e._animatedFavLinkAttr)),e._animatedFav=!e._animatedFav},e._staticFavLinkAttr={rel:"shortcut icon",href:"/favicon.ico",type:"image/x-icon"},e._animatedFavLinkAttr={rel:"shortcut icon",href:"data:image/gif;base64,R0lGODlhIAAgAPceAGYAAJgAAJgBAZkCApoEBJkWGpkAM5krAJkpL5krM6EMDKQPEaARDaYkLassIpkrZplVM5lVZswrM8xVM8xVZsyAZsyAmcyqmcyqzP+qzMzVzP/VzP/V////zP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAhkAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAIAAgAAAI/gATBBhIsKDBgwgTKlyI0ABBgRADRBQ40MCBiRIzUgxAYYPHjyA3ZDgw0ELIkyMHQvDAsqVLlhQvvJzpgSIFmi9j4nRJMcHOlhQt/GQpgSCFCxxmXqhAoeBRmhssVDhYYeYDhDdfbkgAAGHVlxMOynx5wSFCAF9dRjAolCzDti7DEtQwsynDtC3XSszwUoOErm9nhk2w4WWGjQyz8kxA12UHhgbxsrTQgaZeyAHgDoWJOYDkoRswo8W5VXFLDJg1nyYZoPDLqXdnZijocyaEwC9vF1TtgUPsl3YLNnapYeFnxAMl0LSAMEEC3heQJxhLFnHtnaEHOgAtgOBmBAMXIGzuHqDAZoIMxg8kcH5gA/WdDQqYT59+/Pv449MfoCAgACH5BAhkAAAALAAAAAAgACAAh5kAAJwICP38/P39/f7+/v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAifAAsIHEiwoMGDCBMqXMiw4UEAECNKhDhwokWKFS9KzKgxIsGOHgWCDClyJEeQBTs+VLlyI8KLCi22nLhQZkqYNWl+tMmQZwGcDXkCDapzKNGRGB3+REryKFMASlkaTajxZNOYPpfqzOlyZ9aZSb1ufTlWbFeDVdGmNTsUKVufbq22NSlwwMgAA+2OFMCQgF+Cfv8qHUx4YWC/Aw4TGBgQADs%3D",
type:"image/gif"},a.prototype.new_private_message=function(){(e._blurred||void 0!==document.hidden&&document.hidden||void 0!==document.webkitHidden&&document.webkitHidden)&&(e._pmCount++,e._animatedFav||e.toggleFavLink(),document.title="["+e._pmCount+"] "+e._baseTitle,t._pm_chime&&e._chime.play())},a.prototype.showReceivedPM_notifier||(a.prototype.showReceivedPM_notifier=a.prototype.receivedPrivateMessage,a.prototype.receivedPrivateMessage=function(e){e.data.success&&!this._user_manager.isMuted(e.data.from)&&this.new_private_message(),this.showReceivedPM_notifier(e)}),t.addChatCommand("pmchime",function(e,t){return e._pm_chime?(e._pm_chime=0,e.activeDialogue().kongBotMessage("PM chime is OFF")):(e._pm_chime=1,e.activeDialogue().kongBotMessage("PM chime is ON")),window.setTimeout(function(){GM_setValue("kong_pmchime",e._pm_chime)},0),!1});var o=void 0;try{o=GM_setValue?GM_getValue("kong_pmchime",1):1}catch(e){o=1}t._pm_chime=o}}}]),t}(HolodeckScript),ReplyCommand=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Chat Reply-command",/^\/games/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){var e=this.dom,t=e.ChatDialogue;t&&(t.prototype=e.CDprototype||e.ChatDialogue.prototype,t.prototype.oldKeyPressReply||(t.prototype.oldKeyPressReply=t.prototype.onKeyPress,t.prototype.reply?t.prototype.oldreply=t.prototype.reply:t.prototype.oldreply=function(e){},t.prototype.reply=function(e){this._holodeck._reply=e,this.oldreply(e)},t.prototype.showReceivedPM||(t.prototype.showReceivedPM=t.prototype.receivedPrivateMessage,t.prototype.receivedPrivateMessage=function(e){e.data.success&&this.reply(e.data.from),this.showReceivedPM(e)}),t.prototype.onKeyPress=function(e){var t,a=this._input_node.wrappedJSObject||this._input_node;if(32==e.which&&(2==e.currentTarget.selectionStart&&(t=a.getValue().match(/^\/r(.*)/i))||(t=a.getValue().match(/^\/r\b(.*)/i)))){var o=t[1]||"";this._holodeck._reply?this.setInput("/w "+this._holodeck._reply+" "+o):this.setInput("/w "),e.stop&&e.stop(),e.preventDefault&&e.preventDefault()}this.oldKeyPressReply(e)}))}}]),t}(HolodeckScript),ShowScriptOptions=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"this",/^\//,!0));return e.scripts=[],e}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){function e(){"none"!=t.style.display?(t.style.display="none",a.style.display="none",A&&(A.style.visibility="visible")):(t.style.display="",a.style.display="",A&&(A.style.visibility="hidden"))}var t=new Element("div",{style:"background-color:#00000080;position:fixed;top:0px;left:0px;width:100%;height:100%;z-index:10000;display:none;"}),a=new Element("div",{style:"background-color:#FFF;font:normal 11px/15px 'Lucida Grande',Verdana,Arial,sans-serif;padding:8px;display:none;position:fixed;transform:translate(-50%, -50%);top:50%;left:50%;z-index:10000;"}).update("<h2>Scripts</h2>Enable - Script Name<p></p>");t.onclick=e,document.body.appendChild(t),document.body.appendChild(a),this.scripts.map(function(e){function t(){console.log("[KongOne] Toggled script"),GM_setValue(this.id,this.checked)}if("this"==e.name)return!0;var o=new Element("span",{style:"margin-top: 5px !important;display: block;"});a.insert(o);var i=new Element("input",{type:"checkbox",id:"onescript-"+e.name,style:"margin-top:2px;vertical-align:top;margin-right:8px;"}),s=new Element("label",{class:"pls"});i.checked="true"==GM_getValue(i.id,e.defaultEnabled?"true":"false"),s.insert(i),s.insert(e.name),o.insert(s),i.onchange=t});var o=new Element("div",{style:"width:100%;"}),i=new Element("button",{class:"btn btn_wide btn_action",style:"display:block;margin:6px auto auto;"}).update("Exit");i.onclick=e,o.insert(i),a.insert(o);var s=new Element("p").update("Refresh to apply your changes.");a.insert(s);var n=document.getElementById("welcome_box_sign_out"),r=document.createElement("li");r.innerHTML="<a href='#' style='border-bottom: 1px dotted #9b9a9a;display: inline;padding: 0px 5px 10px 5px;'>KongOne</a>",r.onclick=e,n.parentNode.parentNode.insertBefore(r,n.parentNode);var A=document.getElementById("game")}}]),t}(Script),UsernameCompletion=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Chat Username-completion",/^\/games/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){if("undefined"!=typeof ChatDialogue&&!ChatDialogue.prototype.oldKeyPressTab){var e=navigator.appVersion.indexOf("Chrome")>=0;e&&(ChatDialogue.prototype.initialize=ChatDialogue.prototype.initialize.wrap(function(e,t,a,o,i){e(t,a,o,i);var s=this;this._input_node.observe("keydown",function(e){9!=e.keyCode||e.ctrlKey||e.altKey||e.metaKey||s.onKeyPress(e)})})),ChatDialogue.prototype.oldKeyPressTab=ChatDialogue.prototype.onKeyPress,ChatDialogue.prototype.tabcnt=0,ChatDialogue.prototype.done=1,ChatDialogue.prototype.onKeyPress=function(e){if(9!=e.keyCode||e.ctrlKey)return this.tabcnt=0,this.done=1,void this.oldKeyPressTab(e);var t=this._input_node.wrappedJSObject||this._input_node;if(0===this.tabcnt&&1==this.done){var a=t.getValue(),o=a.substr(0,t.selectionStart).lastIndexOf(" ");this._caretPos=t.selectionStart,this._start=a.substr(0,o),this._start&&(this._start+=" "),this._currentWord=a.substring(o+1,this._caretPos),this._rest=a.substr(this._caretPos)}this.done=0;var i=this._holodeck.chatWindow().activeRoom()._users_list,s=[],n=t.getValue();n.match(/\s+$/)&&(n=n.replace(/\s+$/,""));for(var r=0;r<i.length;r++)0===i[r].username.toLowerCase().indexOf(this._currentWord.toLowerCase())&&s.push(i[r].username);this.tabcnt<s.length?(t.setValue(this._start+s[this.tabcnt]+(this._start?" ":": ")+this._rest),t.selectionStart=this._caretPos+s[this.tabcnt].length-this._currentWord.length+(this._start?1:2),t.selectionEnd=t.selectionStart,this.tabcnt+=1):(t.setValue(this._start+this._currentWord+this._rest),t.selectionStart=this._caretPos,t.selectionEnd=this._caretPos,this.tabcnt=0),e.stop&&e.stop(),e.preventDefault&&e.preventDefault()}}}}]),t}(HolodeckScript),WhisperCatch=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Whisper Catch",/^\/games/,!0))}return _inherits(t,e),_createClass(t,[{key:"run",value:function(){var e=this,a=this.dom,o=a.ChatDialogue,i=function(t){e.removeWhisper(t)};holodeck.__wc_whisperCount=0,o.prototype.__wc_receivedPrivateMessage=o.prototype.receivedPrivateMessage,o.prototype.receivedPrivateMessage=function(e){this.__wc_receivedPrivateMessage(e),e.id=holodeck.__wc_whisperCount;var a=JSON.parse(localStorage.getItem(t.WHISPERS_SAVED_KEY))||[];a.push(e),localStorage.setItem(t.WHISPERS_SAVED_KEY,JSON.stringify(a)),setTimeout(i,t.WHISPER_WAIT_TIME,e)},this.__wc_interval=setInterval(function(){e.restoreWhispers()},t.CHAT_DIALOGUE_RETRY),holodeck.addChatCommand("wctime",function(e,a){var o=a.split(" ").slice(1),i=parseInt(o[0]);return isNaN(i)||(localStorage.setItem(t.WHISPER_WAIT_TIME_KEY,i),e.activeDialogue().displayUnsanitizedMessage("Kong Bot","Whisper save time set to "+i+" seconds.",{class:"whisper received_whisper"},{non_user:!0})),!1})}},{key:"restoreWhispers",value:function(){var e=holodeck.activeDialogue(),a=JSON.parse(localStorage.getItem(t.WHISPERS_SAVED_KEY))||[];if(e){for(;a.length>0;){var o=a.shift();e.receivedPrivateMessage(o)}clearInterval(this.__wc_interval)}}},{key:"removeWhisper",value:function(e){var a=(JSON.parse(localStorage.getItem(t.WHISPERS_SAVED_KEY))||[]).filter(function(t){return t.id!=e.id});localStorage.setItem(t.WHISPERS_SAVED_KEY,JSON.stringify(a))}}]),t}(HolodeckScript);WhisperCatch.WHISPERS_SAVED_KEY="wc-whispers_saved",WhisperCatch.WHISPER_WAIT_TIME_KEY="wc-whisper_wait_time_key",WhisperCatch.WHISPER_WAIT_TIME=1e3*parseInt(localStorage.getItem(WhisperCatch.WHISPER_WAIT_TIME_KEY)||15),WhisperCatch.CHAT_DIALOGUE_RETRY=100,function(){console.log("[KongOne] Initializing..."),"undefined"==typeof GM_setValue&&(window.GM_setValue=function(e,t){localStorage.setItem(e,t)},window.GM_getValue=function(e,t){var a=localStorage.getItem(e);return null===a?t:a},window.GM_deleteValue=function(e){localStorage.removeItem(e)});var e=new ShowScriptOptions,t=[e,new ChatTimestamp,new PmNotifier,new ChatLineHighlight,new ReplyCommand,new UsernameCompletion,new ChatMouseoverTimestamp,new AfkCommand,new ChatCharacterLimit,new KongreLink,new ChatResizer,new Kongquer,new WhisperCatch,new LargerAvatars];e.scripts=t,t.map(function(e){return e.initialize()})}();